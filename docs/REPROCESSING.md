# Reprocessing Failed Recordings

## Overview

Sometimes recordings may fail to process correctly due to various issues. The `reprocess_recording.py` tool allows you to re-run the transcription and summarization pipeline on any WAV file.

## Common Reasons for Failed Processing

1. **Empty/Silent Audio**: Recording captured no audio or very quiet audio
2. **Processing Interrupted**: App was quit during processing
3. **Model Loading Issues**: Whisper model failed to load
4. **Network Issues**: Ollama endpoint unavailable during summarization
5. **File Corruption**: Audio file became corrupted
6. **Wrong Settings**: Used wrong language or model settings

## Basic Usage

```bash
python reprocess_recording.py path/to/recording.wav
```

## Examples

### Reprocess with Default Settings

```bash
python reprocess_recording.py recordings/recording_2025-10-21_10-09-16.wav
```

### With Custom Title

```bash
python reprocess_recording.py recordings/recording_2025-10-21_10-09-16.wav \
  --title "Team Standup"
```

### Use Larger Model for Better Accuracy

```bash
python reprocess_recording.py recordings/recording_2025-10-21_10-09-16.wav \
  --model medium
```

Available models:
- `tiny` - Fastest, least accurate
- `base` - Good balance (default)
- `small` - Better accuracy, slower
- `medium` - High accuracy, much slower
- `large` - Best accuracy, very slow

### Force Overwrite Existing Transcript

```bash
python reprocess_recording.py recordings/recording_2025-10-21_10-09-16.wav \
  --force
```

Without `--force`, the tool will warn you if a transcript already exists and ask for confirmation.

### Only Transcribe (Skip Summarization)

Useful for debugging transcription issues:

```bash
python reprocess_recording.py recordings/recording_2025-10-21_10-09-16.wav \
  --skip-summary
```

## What It Does

The reprocessing tool follows these steps:

### 1. Validation
- Checks if audio file exists
- Extracts timestamp from filename
- Shows file size and duration
- Warns if transcript already exists

### 2. Transcription
- Loads Whisper model (uses config settings)
- Transcribes audio file
- Saves transcript to `transcript_YYYY-MM-DD_HH-MM-SS.txt`
- Shows segment count
- **Warns if transcript is empty** (indicates silent audio)

### 3. Summarization (unless --skip-summary)
- Connects to Ollama endpoint
- Generates meeting summary
- Saves summary to `summary_YYYY-MM-DD_HH-MM-SS.md`

### 4. Markdown Output
- Writes final files to Obsidian vault
- Copies audio file (if keep_audio enabled)
- Creates properly formatted meeting notes

## Debugging Empty Transcripts

If you get a warning like:

```
⚠️  Warning: Transcript is very short or empty
Transcript length: 50 characters

Possible issues:
  - Audio is silent or very quiet
  - Wrong audio format
  - Audio is corrupted
  - Language mismatch (expecting English)
```

### Check Audio Playback

```bash
# Check if audio has content
ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 your_recording.wav

# Play the audio (to hear if it's silent)
ffplay your_recording.wav
```

### Try Larger Model

Sometimes the base model misses quiet speech:

```bash
python reprocess_recording.py your_recording.wav --model medium
```

### Check Audio Levels

If audio is too quiet, you may need to boost the volume during recording. The TUI shows audio level meters - make sure they're showing activity.

## Finding Failed Recordings

### List Recordings Without Transcripts

```bash
cd recordings/
for f in recording_*.wav; do
    transcript="${f/recording_/transcript_}"
    transcript="${transcript/.wav/.txt}"
    if [ ! -f "$transcript" ] || [ $(wc -l < "$transcript") -lt 10 ]; then
        echo "Failed: $f"
    fi
done
```

### Check Log File

The log file `meeting_recorder.log` contains detailed error messages:

```bash
grep -A 5 "✗ Job failed" meeting_recorder.log
```

## Batch Reprocessing

Reprocess multiple failed recordings:

```bash
# Find all recordings without proper transcripts
for recording in recordings/recording_*.wav; do
    timestamp=$(basename "$recording" .wav | sed 's/recording_//')
    transcript="recordings/transcript_${timestamp}.txt"

    # Check if transcript is missing or empty
    if [ ! -f "$transcript" ] || [ $(wc -l < "$transcript") -lt 10 ]; then
        echo "Reprocessing: $recording"
        python reprocess_recording.py "$recording" --force
    fi
done
```

## Output Files

After successful reprocessing, you'll have:

1. **Transcript**: `recordings/transcript_YYYY-MM-DD_HH-MM-SS.txt`
   - Full timestamped transcript
   - Used as input for summarization

2. **Summary**: `recordings/summary_YYYY-MM-DD_HH-MM-SS.md`
   - Meeting summary with action items
   - Generated by Ollama

3. **Markdown Files** (in Obsidian vault):
   - `meetings/YYYY-MM-DD_HH-MM_transcript.md`
   - `meetings/YYYY-MM-DD_HH-MM_summary.md`
   - `meetings/YYYY-MM-DD_HH-MM_audio.wav` (if keep_audio enabled)

## Troubleshooting

### "Audio file not found"

Make sure the path is correct:

```bash
ls -lh recordings/recording_2025-10-21_10-09-16.wav
```

### "Transcription failed: No module named 'faster_whisper'"

Install dependencies:

```bash
pip install -r requirements.txt
```

### "Ollama connection failed"

Check if Ollama is running:

```bash
curl https://ollama.firecorn.net/api/tags
```

If it's down, use `--skip-summary` to at least get the transcript.

### Memory Issues with Large Models

If you get out-of-memory errors with `medium` or `large` models:

1. Close other applications
2. Use `base` model instead
3. Process files one at a time
4. Use server processing (v0.4) instead

## Integration with Processing Queue

The reprocessing tool is standalone and does NOT use the processing queue. This means:

✅ Can run while TUI is running
✅ Won't interfere with ongoing recordings
✅ Direct, immediate processing
✅ Better for debugging

However, it won't show up in the TUI's processing status.

## Future Enhancements

Potential improvements:

- **Auto-detect failed recordings**: Scan and prompt for reprocessing
- **Bulk reprocessing UI**: TUI screen to select and reprocess multiple files
- **Custom prompts**: Override summarization prompt for specific meetings
- **Export formats**: Output to different formats (PDF, HTML, etc.)
- **Audio enhancement**: Boost volume or reduce noise before transcription

## Related Files

- [reprocess_recording.py](../reprocess_recording.py) - The reprocessing tool
- [src/transcribe.py](../src/transcribe.py) - Transcription logic
- [src/summarize.py](../src/summarize.py) - Summarization logic
- [docs/QUIT_SAFETY.md](QUIT_SAFETY.md) - Preventing processing failures
- [meeting_recorder.log](../meeting_recorder.log) - Processing logs
